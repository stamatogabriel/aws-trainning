# Networking

## Learning objectives

In this module, you will learn how to:

- Describe the basic concepts of networking.
- Describe the difference between public and private networking resources. 
- Explain a virtual private gateway using a real life scenario. 
- Explain a virtual private network (VPN) using a real life scenario.
- Describe the benefit of AWS Direct Connect. 
- Describe the benefit of hybrid deployments. 
- Describe the layers of security used in an IT strategy.
- Describe the services customers use to interact with the AWS global network.

Se pensarmos em nossa cafeteria ou conta AWS, as coisas agora devem estar funcionando bem. No entanto, e se tivéssemos alguns clientes ansiosos que quisessem dar seus pedidos diretamente aos baristas, em vez de ao caixa na frente? Bem, não faz sentido permitir que todos os clientes possam interagir com nossos baristas, já que eles estão focados em preparar algumas bebidas com cafeína frescas. Então, o que fazemos?

Isso mesmo, crianças, digam comigo, Amazon Virtual Private Cloud, ou VPCs, como são carinhosamente conhecidos. Um VPC permite provisionar uma seção isolada logicamente da nuvem AWS, onde você pode iniciar recursos AWS em uma rede virtual que você definir. Esses recursos podem ser públicos, para que tenham acesso à Internet, ou privados, sem acesso à Internet, geralmente para serviços de back-end como bancos de dados ou servidores de aplicativos. O agrupamento público e privado de recursos são conhecidos como sub-redes e são intervalos de endereços IP em seu VPC.

Agora, em nossa cafeteria, temos funcionários diferentes e um deles é caixa. Eles aceitam os pedidos dos clientes e, portanto, queremos que os clientes interajam com eles, então os colocamos no que chamamos de sub-rede pública. Assim, eles podem falar com os clientes ou com a internet. Mas, para nossos baristas, queremos que eles se concentrem em fazer café e não interagir diretamente com os clientes, por isso os colocamos em uma sub-rede privada.

## Connectivity to AWS

Um VPC, ou nuvem privada virtual, é essencialmente sua própria rede privada na AWS. Um VPC permite que você defina seu intervalo de IP privado para seus recursos da AWS e você coloque coisas como instâncias EC2 e ELBs dentro de seu VPC.

Agora você não apenas joga seus recursos em um VPC e segue em frente. Você os coloca em diferentes sub-redes. Sub-redes são blocos de endereços IP em seu VPC que permitem agrupar recursos. As sub-redes, junto com as regras de rede que abordaremos posteriormente, controlam se os recursos estão disponíveis pública ou privadamente. O que ainda não dissemos é que existem maneiras de controlar o tráfego que entra em seu VPC. O que quero dizer com isso é que, para alguns VPCs, você pode ter recursos voltados para a Internet que o público deve ser capaz de alcançar, como um site público, por exemplo.

No entanto, em outros cenários, você pode ter recursos que só deseja que sejam alcançados se alguém estiver conectado à sua rede privada. Podem ser serviços internos, como um aplicativo de RH ou um banco de dados de back-end. Primeiro, vamos falar sobre recursos voltados ao público. Para permitir que o tráfego da Internet pública entre e saia de seu VPC, você deve conectar o que é chamado de gateway de Internet, ou IGW, ao seu VPC.

Um portal de internet é como uma porta aberta ao público. Pense em nossa cafeteria. Sem uma porta de entrada, os clientes não podiam entrar e pedir seu café, então instalamos uma porta de frente e as pessoas podem entrar e sair por ela ao entrar e sair de nossa loja. A porta da frente neste exemplo é como um gateway de Internet. Sem ele, ninguém pode acessar os recursos colocados dentro de seu VPC.

A seguir, vamos falar sobre um VPC com todos os recursos privados internos. Não queremos que qualquer pessoa de qualquer lugar possa acessar esses recursos. Portanto, não queremos um gateway de Internet conectado ao nosso VPC. Em vez disso, queremos um gateway privado que só permita a entrada de pessoas se vierem de uma rede aprovada, não da Internet pública. Essa porta privada é chamada de gateway privado virtual e permite que você crie uma conexão VPN entre uma rede privada, como seu data center local ou rede corporativa interna para seu VPC.

Relacionar isso com a cafeteria, seria como ter uma rota de ônibus particular indo do meu prédio até a cafeteria. Se eu quiser ir tomar um café, primeiro preciso entrar no prédio, autenticando assim minha identidade, e então posso pegar a rota secreta do ônibus para a cafeteria interna que apenas as pessoas do meu prédio podem usar. Portanto, se você quiser estabelecer uma conexão VPN criptografada com seus recursos internos privados da AWS, precisará anexar um gateway privado virtual ao seu VPC.

Agora, o problema com a nossa rota de ônibus super secreta é que ela ainda usa a estrada aberta. É suscetível a engarrafamentos e lentidão causados ​​pelo resto do mundo cuidando de seus negócios. A mesma coisa vale para conexões VPN. Eles são privados e criptografados, mas ainda usam uma conexão de Internet normal com largura de banda compartilhada por muitas pessoas que usam a Internet.

Então, o que fiz para tornar as coisas mais confiáveis ​​e menos suscetíveis a lentidão é uma porta mágica totalmente separada que leva diretamente do estúdio para a cafeteria. Ninguém mais dirigindo na estrada pode me atrasar porque esta é minha porta direta; ninguém mais pode usá-lo. O quê, você não tinha uma porta mágica secreta para entrar na sua cafeteria favorita? Tudo bem, continuando. A questão é que você ainda deseja uma conexão privada, mas deseja que ela seja dedicada e compartilhada com mais ninguém. Você deseja a menor latência possível com a maior quantidade de segurança possível.

Com a AWS, você pode conseguir isso usando o que é chamado de AWS Direct Connect. A Conexão direta permite que você estabeleça uma conexão de fibra dedicada e completamente privada do seu data center para a AWS. Você trabalha com um parceiro Direct Connect em sua área para estabelecer essa conexão, porque, como minha porta mágica, o AWS Direct Connect fornece uma linha física que conecta sua rede ao AWS VPC. Isso pode ajudá-lo a atender às altas necessidades regulamentares e de conformidade, bem como evitar quaisquer problemas potenciais de largura de banda. Também é importante observar que um VPC pode ter vários tipos de gateways anexados para vários tipos de recursos, todos residentes no mesmo VPC, apenas em sub-redes diferentes.

## Subnets and network access control lists
Bem-vindo ao seu VPC. Você pode pensar nisso como uma fortaleza reforçada onde nada entra ou sai sem permissão explícita. Você tem um gateway no VPC que permite apenas o tráfego de entrada ou saída do VPC. Mas isso cobre apenas o perímetro, e essa é apenas uma parte da segurança de rede que você deve se concentrar como parte de sua estratégia de TI.

A AWS tem uma ampla gama de ferramentas que cobrem todas as camadas de segurança: proteção de rede, segurança de aplicativo, identidade do usuário, autenticação e autorização, negação de serviço distribuída ou prevenção DDoS, integridade de dados, criptografia e muito mais. Vamos falar sobre algumas dessas peças-chave. E se você realmente quer saber mais sobre segurança, siga os links nesta página para obter mais informações e treinamento adicional sobre como bloquear sua infraestrutura de forma mais rígida do que a receita secreta de torta de limão da Tia Robin, e ninguém está recebendo essa receita .

Hoje, gostaria de falar sobre alguns aspectos da proteção de rede, observando o que acontece dentro do VPC. Agora, o único motivo técnico para usar sub-redes em um VPC é controlar o acesso aos gateways. As sub-redes públicas têm acesso ao gateway da Internet; as sub-redes privadas não. Mas as sub-redes também podem controlar as permissões de tráfego. Pacotes são mensagens da Internet e cada pacote que cruza os limites da sub-rede é verificado em relação a algo chamado lista de controle de acesso à rede ou ACL da rede. Essa verificação é para ver se o pacote tem permissão para sair ou entrar na sub-rede com base em quem foi enviado e como está tentando se comunicar.

Você pode pensar nas ACLs de rede como oficiais de controle de passaportes. Se você estiver na lista de aprovados, você passa. Se você não estiver na lista, ou se estiver explicitamente na lista do-não-entrar, você será bloqueado. As ACLs de rede verificam o tráfego que entra e sai de uma sub-rede, assim como o controle de passaporte. A lista é verificada no seu caminho para um país e no caminho de saída. E só porque você foi autorizado a entrar não significa necessariamente que eles o deixarão sair. O tráfego aprovado pode ser enviado em seu caminho, e o tráfego potencialmente prejudicial, como tentativas de obter o controle de um sistema por meio de solicitações administrativas, é bloqueado antes mesmo de tocar o alvo. Você não pode hackear o que não pode tocar.

Agora, isso parece uma ótima segurança, mas não responde a todos os problemas de controle de rede. Porque uma ACL de rede avalia um pacote apenas se ele cruzar um limite de sub-rede, entrando ou saindo. Não avalia se um pacote pode atingir uma instância específica do EC2 ou não. Às vezes, você terá várias instâncias do EC2 na mesma sub-rede, mas elas podem ter regras diferentes sobre quem pode enviar mensagens, para qual porta essas mensagens podem ser enviadas. Portanto, você também precisa de segurança de rede em nível de instância.

Para resolver questões de acesso de nível de instância, apresentamos grupos de segurança. Cada instância EC2, quando é iniciada, vem automaticamente com um grupo de segurança. E, por padrão, o grupo de segurança não permite nenhum tráfego para a instância. Todas as portas estão bloqueadas; todos os endereços IP que enviam pacotes são bloqueados. Isso é muito seguro, mas talvez não seja muito útil. Se você deseja que uma instância aceite tráfego externo, como, digamos, uma mensagem de uma instância de front end ou uma mensagem da Internet. Obviamente, você pode modificar o grupo de segurança para aceitar um tipo específico de tráfego. No caso de um site, você deseja que o tráfego baseado na web ou HTTPS seja aceito, mas não outros tipos de tráfego, como um sistema operacional ou solicitações de administração.

Se os NACLs são um controle de passaporte, um grupo de segurança é como o porteiro do seu prédio, sendo o prédio a instância do EC2, neste caso. O porteiro verificará uma lista para garantir que alguém tem permissão para entrar no prédio, mas não se preocupará em verificar a lista ao sair. Com grupos de segurança, você permite a entrada de tráfego específico e, por padrão, todo o tráfego é permitido de saída. Agora, espere um minuto, Blaine. Você acabou de descrever dois motores diferentes, cada um fazendo exatamente o mesmo trabalho. Deixe os pacotes bons entrarem, mantenha os pacotes ruins fora. A principal diferença entre um grupo de segurança e uma ACL de rede é que o grupo de segurança tem estado, ou seja, como falamos, ele tem algum tipo de memória quando se trata de quem permitir a entrada ou saída, e a ACL de rede não tem estado, que não se lembra de nada e verifica cada pacote que cruza sua fronteira, independentemente de quaisquer circunstâncias.

Você sabe, essa metáfora é importante entender. Portanto, quero ilustrar a viagem de ida e volta de um pacote conforme ele vai de uma instância para outra em uma sub-rede diferente. Agora, esse gerenciamento de tráfego, não se preocupa com o conteúdo do pacote em si. Na verdade, nem abre o envelope, não consegue. Tudo o que pode fazer é verificar se o remetente está na lista de aprovados.

Tudo certo. Vamos começar com a instância A. Queremos enviar um pacote da instância A para a instância B em uma sub-rede diferente, mesmo VPC, sub-redes diferentes. Portanto, a instância A envia o pacote. Agora, a primeira coisa que acontece é que o pacote atende ao limite do grupo de segurança da instância A. Por padrão, todo o tráfego de saída é permitido de um grupo de segurança. Então você pode passar direto pelos porteiros e sair, legal, certo. O pacote passou pelo grupo de segurança da instância A. Agora, ele precisa sair do limite da sub-rede. No limite, o passaporte agora deve passar pelo controle de passaporte, a rede ACL. A rede ACL não se preocupa com o que o grupo de segurança permitiu. Ele tem sua própria lista de quem pode passar e quem não pode. Se o endereço de destino for permitido, você pode continuar sua jornada, o que é verdade.

Portanto, agora saímos da sub-rede original e agora o pacote vai para a sub-rede de destino onde a instância B reside. Agora, nesta sub-rede de destino, mais uma vez, temos o controle de passaporte. Só porque o pacote foi autorizado a sair de seu país de origem, não significa que ele pode entrar no país de destino ou na sub-rede neste caso. Ambos têm oficiais de passaportes exclusivos com suas próprias listas de verificação. Você tem que ser aprovado em ambas as listas, ou pode ser rejeitado na fronteira. Bem, acontece que o pacote está na lista de aprovados para esta sub-rede, então é permitido entrar pela ACL da rede na sub-rede. Quase lá. Agora, estamos nos aproximando da instância de destino, instância B. Cada instância EC2 tem seu próprio grupo de segurança. Se você quiser entrar nesta instância, o porteiro precisará verificar se você tem permissão para entrar e estamos na lista. O pacote atingiu a instância de destino.

Assim que a transação for concluída, agora é só hora de voltar para casa. É o padrão de tráfego de retorno. É o mais interessante, porque é aqui que a natureza com estado versus sem estado dos diferentes motores entra em jogo. Porque o pacote ainda precisa ser avaliado em cada ponto de verificação. Os grupos de segurança, por padrão, permitem todo o tráfego de retorno. Assim, eles não precisam verificar uma lista para ver se têm permissão para sair. Em vez disso, eles permitem automaticamente que o tráfego de retorno passe, aconteça o que acontecer. Controle de passaporte aqui no limite da sub-rede, essas ACLs de rede não se lembram do estado. Eles não se importam que o pacote tenha entrado aqui. Pode estar em uma lista de você não pode sair. Cada entrada e saída são verificadas com a lista apropriada. O endereço de devolução do pacote deve estar na lista de aprovados para que ele atravesse a fronteira. Chegamos à fronteira da sub-rede de origem, mas temos que negociar o controle de ACL da rede de passaportes aqui também. Controles sem estado, significa que sempre verifica sua lista.

O pacote passa pela ACL da rede, o nível da sub-rede, o que significa que os pacotes agora voltaram para a instância A, mas o grupo de segurança, o porteiro ainda está no comando aqui. A principal diferença, porém, é que esses grupos de segurança têm estado. O grupo de segurança reconhece o pacote anterior. Portanto, não é necessário verificar se é permitido entrar. Venha para casa.

Agora, pode parecer que gastamos muito esforço apenas para levar um pacote de uma instância para outra e de volta. Você pode estar preocupado com toda a sobrecarga de rede que isso pode gerar. A realidade é que todas essas trocas acontecem instantaneamente como parte de como o AWS Networking realmente funciona. Se você quer conhecer a tecnologia que torna tudo isso possível, então você precisa se inscrever para um conjunto de treinamentos completamente diferente. Uma boa segurança de rede aproveitará as vantagens das ACLs de rede e dos grupos de segurança, porque a segurança em profundidade é crítica para arquiteturas modernas.

## Global Networking
Falamos muito sobre como você interage com sua infraestrutura AWS. Mas como seus clientes interagem com sua infraestrutura AWS? Bem, se você tem um site hospedado na AWS, os clientes geralmente entram em seu site no navegador, pressionam Enter, alguma mágica acontece e o site é aberto.

Mas como essa mágica funciona? Bem, assim como esta moeda mágica que tenho aqui, você sabe, você dá uma mordida e ela está de volta. Bem, não é bem assim, mas vou mostrar a vocês dois serviços, que ajudariam no caso do site. O primeiro sendo o Route 53. O Route 53 é o serviço de nome de domínio da AWS, ou DNS, e é altamente disponível e escalonável. Mas espere, o que é DNS, você diz? Pense no DNS como um serviço de tradução. Mas, em vez de traduzir entre os idiomas, ele traduz nomes de sites em endereços IP, ou protocolo da Internet, que os computadores podem ler.

Por exemplo, quando inserimos um endereço de site em nosso navegador, ele contata o Route 53 para obter o endereço IP do site, digamos, 192.1.1.1, e então encaminha seu computador ou navegador para esse endereço. Se formos além, o Route 53 pode direcionar o tráfego para diferentes endpoints usando várias políticas de roteamento diferentes, como roteamento baseado em latência, geolocalização DNS, geoproximidade e round robin ponderado. Se usarmos o DNS de geolocalização, isso significa que direcionamos o tráfego com base na localização do cliente. Assim, o tráfego proveniente, digamos, da América do Norte é roteado para a região de Oregon e o tráfego da Irlanda é roteado para a região de Dublin, por exemplo.

Você pode até usar o Route 53 para registrar nomes de domínio, para que possa comprar e gerenciar seus próprios nomes de domínio diretamente na AWS.

Falando em sites, há outro serviço que pode ajudar a acelerar a entrega de ativos de sites aos clientes, o Amazon CloudFront. Se você se lembra, falamos sobre os locais de extremidade no início do curso, esses locais estão servindo conteúdo o mais próximo possível dos clientes e uma parte disso é a rede de distribuição de conteúdo, ou CDN. Para quem precisa ser lembrado, um CDN é uma rede que ajuda a fornecer conteúdo de ponta aos usuários com base em sua localização geográfica.

Se voltarmos ao nosso exemplo da América do Norte versus Irlanda, digamos que temos um usuário em Seattle e ele deseja acessar um site, para acelerar isso, hospedamos o site em Oregon e implantamos nossos ativos estáticos da web, como imagens e GIFs no CloudFront na América do Norte. Isso significa que eles recebem o conteúdo o mais próximo possível deles, neste caso a América do Norte, quando acessam o site. Mas para nossos usuários irlandeses, não faz sentido entregar esses ativos fora do Oregon, pois a latência não é favorável. Assim, implantamos esses mesmos ativos estáticos no CloudFront, mas desta vez na região de Dublin. Isso significa que eles podem acessar o mesmo conteúdo, mas de um local mais próximo a eles, o que, por sua vez, melhora a latência.

## Sumary
In Module 4, you learned about the following concepts:

- Structuring and connecting to a VPC
- Securing VPC resources with network access control lists and security groups
- Using Amazon Route 53 and Amazon CloudFront to deliver content

A rede costumava ser o domínio exclusivo dos gênios topológicos. Com a AWS, a rede agora é simplificada e abstraída para responder à simples pergunta de quem deve ter permissão para se comunicar. Contanto que você possa responder a essa pergunta, você pode configurar sua rede na AWS.

Cobrimos o básico de VPC, a nuvem privada virtual, a maneira como você isola sua carga de trabalho na AWS, os fundamentos da segurança de rede, incluindo gateways, ACLs de rede e grupos de segurança, todos os métodos que permitem que seus engenheiros de segurança criem uma rede que permite acesso de tráfego saudável enquanto elimina ataques subversivos antes que eles atinjam sua instância, maneiras de se conectar à AWS por meio de VPN e até mesmo Direct Connect, pipelines seguros que são criptografados pela Internet geral ou fibra exclusiva usada por você e somente você.

Também falamos sobre as redes globais que a AWS fornece usando nossos locais de borda, como você pode usar o Route 53 para DNS e como usar o CloudFront para armazenar conteúdo em cache mais perto de seus consumidores reais.
